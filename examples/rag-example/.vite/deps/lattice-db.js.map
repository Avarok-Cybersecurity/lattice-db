{
  "version": 3,
  "sources": ["../../node_modules/lattice-db/dist/lattice-db.esm.js"],
  "sourcesContent": ["// src/lattice.ts\nvar wasmModule = null;\nvar initialized = false;\nvar LatticeDB = class _LatticeDB {\n  constructor(db) {\n    this.db = db;\n  }\n  /**\n   * Initialize LatticeDB\n   *\n   * Must be called before creating instances. Loads the WASM module.\n   *\n   * @param wasmPath - Optional path to WASM file (defaults to ./wasm/lattice_server_bg.wasm)\n   * @returns A new LatticeDB instance\n   *\n   * @example\n   * ```typescript\n   * const db = await LatticeDB.init();\n   * // or with custom WASM path\n   * const db = await LatticeDB.init('/assets/lattice.wasm');\n   * ```\n   */\n  static async init(wasmPath) {\n    if (!initialized) {\n      wasmModule = await import(\"../wasm/lattice_server.js\");\n      await wasmModule.default(wasmPath);\n      initialized = true;\n    }\n    if (!wasmModule) {\n      throw new Error(\"WASM module not loaded\");\n    }\n    const db = new wasmModule.LatticeDB();\n    return new _LatticeDB(db);\n  }\n  // === Collections ===\n  /**\n   * Create a new collection\n   *\n   * @param name - Collection name (alphanumeric, underscores allowed)\n   * @param config - Collection configuration\n   *\n   * @example\n   * ```typescript\n   * db.createCollection('products', {\n   *   vectors: { size: 768, distance: 'Cosine' },\n   *   hnsw_config: { m: 16, ef_construct: 200 }\n   * });\n   * ```\n   */\n  createCollection(name, config) {\n    try {\n      const result = this.db.createCollection(name, config);\n      if (!result || result.status !== \"ok\" || result.result !== true) {\n        const errorMsg = result?.error || `status=${result?.status}, result=${result?.result}`;\n        throw new Error(`Failed to create collection: ${name} - ${errorMsg}`);\n      }\n    } catch (e) {\n      if (e instanceof Error) throw e;\n      throw new Error(`Failed to create collection: ${name} - ${String(e)}`);\n    }\n  }\n  /**\n   * List all collections\n   *\n   * @returns Array of collection names\n   */\n  listCollections() {\n    const result = this.db.listCollections();\n    if (result.status !== \"ok\" || result.result === void 0) {\n      throw new Error(`Failed to list collections: ${result.error || \"unknown error\"}`);\n    }\n    return result.result;\n  }\n  /**\n   * Get collection info\n   *\n   * @param name - Collection name\n   * @returns Collection info including point count and configuration\n   */\n  getCollection(name) {\n    const result = this.db.getCollection(name);\n    if (result.status !== \"ok\" || result.result === void 0) {\n      throw new Error(`Failed to get collection '${name}': ${result.error || \"unknown error\"}`);\n    }\n    return result.result;\n  }\n  /**\n   * Delete a collection\n   *\n   * @param name - Collection name to delete\n   * @returns true if deleted, false if not found\n   */\n  deleteCollection(name) {\n    return this.db.deleteCollection(name);\n  }\n  // === Points ===\n  /**\n   * Upsert points into a collection\n   *\n   * Inserts new points or updates existing ones by ID.\n   *\n   * @param collection - Collection name\n   * @param points - Array of points to upsert\n   * @returns Upsert result\n   *\n   * @example\n   * ```typescript\n   * db.upsert('docs', [\n   *   { id: 1, vector: [0.1, 0.2, ...], payload: { title: 'Doc 1' } },\n   *   { id: 2, vector: [0.3, 0.4, ...], payload: { title: 'Doc 2' } }\n   * ]);\n   * ```\n   */\n  upsert(collection, points) {\n    const result = this.db.upsert(collection, points);\n    if (result.status !== \"ok\" || result.result === void 0) {\n      throw new Error(`Failed to upsert into '${collection}': ${result.error || \"unknown error\"}`);\n    }\n    return result.result;\n  }\n  /**\n   * Get points by IDs\n   *\n   * @param collection - Collection name\n   * @param ids - Array of point IDs to retrieve\n   * @param options - Optional settings for payload/vector inclusion\n   * @returns Array of point records\n   */\n  getPoints(collection, ids, options) {\n    const idsArray = new BigUint64Array(ids.map((id) => BigInt(id)));\n    const result = this.db.getPoints(\n      collection,\n      idsArray,\n      options?.withPayload ?? true,\n      options?.withVector ?? false\n    );\n    if (result.status !== \"ok\" || result.result === void 0) {\n      throw new Error(`Failed to get points from '${collection}': ${result.error || \"unknown error\"}`);\n    }\n    return result.result;\n  }\n  /**\n   * Delete points by IDs\n   *\n   * @param collection - Collection name\n   * @param ids - Array of point IDs to delete\n   * @returns Number of points deleted\n   */\n  deletePoints(collection, ids) {\n    const idsArray = new BigUint64Array(ids.map((id) => BigInt(id)));\n    this.db.deletePoints(collection, idsArray);\n    return ids.length;\n  }\n  // === Search ===\n  /**\n   * Search for nearest neighbors\n   *\n   * Uses HNSW algorithm for fast approximate nearest neighbor search.\n   *\n   * @param collection - Collection name\n   * @param vector - Query vector\n   * @param limit - Maximum results to return\n   * @param options - Optional search parameters\n   * @returns Array of search results with scores\n   *\n   * @example\n   * ```typescript\n   * const results = db.search('docs', queryEmbedding, 10, {\n   *   with_payload: true,\n   *   score_threshold: 0.7\n   * });\n   *\n   * for (const result of results) {\n   *   console.log(`ID: ${result.id}, Score: ${result.score}`);\n   * }\n   * ```\n   */\n  search(collection, vector, limit, options) {\n    const vectorArray = new Float32Array(vector);\n    const result = this.db.search(collection, vectorArray, limit, options);\n    if (result.status !== \"ok\" || result.result === void 0) {\n      throw new Error(`Failed to search '${collection}': ${result.error || \"unknown error\"}`);\n    }\n    return result.result;\n  }\n  /**\n   * Scroll through all points with pagination\n   *\n   * @param collection - Collection name\n   * @param options - Scroll options (limit, offset, etc.)\n   * @returns Scroll result with points and next offset\n   */\n  scroll(collection, options) {\n    const result = this.db.scroll(collection, options);\n    if (result.status !== \"ok\" || result.result === void 0) {\n      throw new Error(`Failed to scroll '${collection}': ${result.error || \"unknown error\"}`);\n    }\n    return result.result;\n  }\n  // === Graph ===\n  /**\n   * Add an edge between two points\n   *\n   * Creates a directed relationship in the graph layer.\n   *\n   * @param collection - Collection name\n   * @param fromId - Source point ID\n   * @param toId - Target point ID\n   * @param relation - Relation type (e.g., 'KNOWS', 'SIMILAR_TO')\n   * @param weight - Optional edge weight (default: 1.0)\n   *\n   * @example\n   * ```typescript\n   * // Create relationships\n   * db.addEdge('people', 1, 2, 'KNOWS');\n   * db.addEdge('docs', 100, 200, 'CITES', 0.8);\n   * ```\n   */\n  addEdge(collection, fromId, toId, relation, weight) {\n    this.db.addEdge(collection, BigInt(fromId), BigInt(toId), relation, weight);\n  }\n  /**\n   * Traverse the graph from a starting point\n   *\n   * Performs breadth-first traversal up to specified depth.\n   *\n   * @param collection - Collection name\n   * @param startId - Starting point ID\n   * @param maxDepth - Maximum traversal depth\n   * @param relations - Optional filter for relation types\n   * @returns Traversal result with nodes and edges\n   *\n   * @example\n   * ```typescript\n   * const result = db.traverse('people', 1, 3, ['KNOWS', 'WORKS_WITH']);\n   * for (const node of result.nodes) {\n   *   console.log(`Found: ${node.id} at depth ${node.depth}`);\n   * }\n   * ```\n   */\n  traverse(collection, startId, maxDepth, relations) {\n    const result = this.db.traverse(collection, BigInt(startId), maxDepth, relations);\n    if (result.status !== \"ok\" || result.result === void 0) {\n      throw new Error(`Failed to traverse '${collection}': ${result.error || \"unknown error\"}`);\n    }\n    return result.result;\n  }\n  /**\n   * Execute a Cypher query\n   *\n   * Supports a subset of openCypher for graph pattern matching.\n   *\n   * @param collection - Collection name\n   * @param cypher - Cypher query string\n   * @param parameters - Optional query parameters\n   * @returns Query result with columns and rows\n   *\n   * @example\n   * ```typescript\n   * const result = db.query('people',\n   *   'MATCH (p:Person)-[:KNOWS]->(friend) WHERE p.id = $id RETURN friend.name',\n   *   { id: 1 }\n   * );\n   *\n   * for (const row of result.rows) {\n   *   console.log(`Friend: ${row[0]}`);\n   * }\n   * ```\n   */\n  query(collection, cypher, parameters) {\n    const result = this.db.query(collection, cypher, parameters);\n    if (result.status !== \"ok\" || result.result === void 0) {\n      throw new Error(`Failed to execute query on '${collection}': ${result.error || \"unknown error\"}`);\n    }\n    return result.result;\n  }\n};\nexport {\n  LatticeDB,\n  LatticeDB as default\n};\n"],
  "mappings": "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",
  "names": []
}
